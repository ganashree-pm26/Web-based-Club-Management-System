<!doctype html>
<html>
<head>
  <title>Participants</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
        min-height: 100vh;
        background: radial-gradient(circle at top left, #4f46e5 0, #0f172a 45%, #020617 100%);
        color: #e5e7eb;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        padding: 24px;
    }
    .glass-card {
        background: rgba(15, 23, 42, 0.9);
        border-radius: 18px;
        border: 1px solid rgba(148, 163, 184, 0.3);
        box-shadow: 0 18px 45px rgba(15, 23, 42, 0.65);
        color: #e5e7eb;
        padding: 30px;
    }
    form.inline { display: inline-block; margin: 0; }
    .table {
        color: #e5e7eb !important;
    }
    .table thead th {
        border-bottom: 1px solid rgba(148, 163, 184, 0.3) !important;
        color: #e5e7eb !important;
        background: rgba(30, 41, 59, 0.6) !important;
    }
    .table tbody tr {
        border-bottom: 1px solid rgba(148, 163, 184, 0.2) !important;
    }
    .table tbody td {
        background: rgba(15, 23, 42, 0.5) !important;
        color: #e5e7eb !important;
        border: 1px solid rgba(148, 163, 184, 0.2) !important;
    }
    .form-control, .form-select {
        background: rgba(30, 41, 59, 0.8) !important;
        border: 1px solid rgba(148, 163, 184, 0.3) !important;
        color: #e5e7eb !important;
        border-radius: 8px !important;
    }
    .form-control:focus, .form-select:focus {
        background: rgba(30, 41, 59, 0.9) !important;
        border-color: #4f46e5 !important;
        color: #e5e7eb !important;
    }
    label {
        color: #e5e7eb !important;
    }
    h1, h2, h3, h4, h5, h6 {
        color: #e5e7eb !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="glass-card">
      <h1 class="mb-4">All Participants</h1>

      <form method="get" action="/participants/list" class="mb-4 row g-3">
        <div class="col-md-3">
          <label class="form-label">Event:</label>
          <select name="eventId" class="form-select">
            <option value="">All</option>
            <% events.forEach(e => { %>
              <option value="<%= e.EventID %>" <%= (req.query.eventId == e.EventID) ? 'selected' : '' %>><%= e.EventName %></option>
            <% }) %>
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label">Team ID:</label>
          <input type="text" name="teamId" class="form-control" value="<%= req.query.teamId || '' %>">
        </div>
        <div class="col-md-2">
          <label class="form-label">Pay Status:</label>
          <select name="payStatus" class="form-select">
            <option value="">All</option>
            <option value="unpaid" <%= req.query.payStatus==='unpaid'?'selected':'' %>>Unpaid</option>
            <option value="pending" <%= req.query.payStatus==='pending'?'selected':'' %>>Pending</option>
            <option value="paid" <%= req.query.payStatus==='paid'?'selected':'' %>>Paid</option>
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label">Attendance:</label>
          <select name="attendanceStatus" class="form-select">
            <option value="">All</option>
            <option value="pending" <%= req.query.attendanceStatus==='pending'?'selected':'' %>>Pending</option>
            <option value="present" <%= req.query.attendanceStatus==='present'?'selected':'' %>>Present</option>
            <option value="absent" <%= req.query.attendanceStatus==='absent'?'selected':'' %>>Absent</option>
          </select>
        </div>
        <div class="col-md-3 d-flex align-items-end">
          <button type="submit" class="btn btn-primary w-100">Filter</button>
        </div>
      </form>

      <div class="table-responsive">
        <table class="table table-bordered">
          <thead><tr>
            <th>ID</th><th>Name</th><th>Email</th><th>Phone</th><th>Event</th><th>Team</th>
            <th>Pay Status</th><th>Amount Paid</th><th>Reg Date</th><th>Attendance</th><th>Actions</th>
          </tr></thead>
    <tbody>
      <% participants.forEach(p => { %>
        <tr>
          <td><%= p.ParticipantID %></td>
          <td><%= p.ParticipantName %></td>
          <td><%= p.Email || "-" %></td>
          <td><%= p.Phone || "-" %></td>
          <td><%= p.EventName %> (ID:<%= p.EventID %>)</td>
          <td><%= p.TeamName ? p.TeamName + ' ('+p.TeamID+')' : '-' %></td>
          <td><%= p.PayStatus || '-' %></td>
          <td><%= p.AmountPaid || 0 %></td>
          <td><%= p.RegDate ? new Date(p.RegDate).toISOString().split('T')[0] : '-' %></td>
          <td><%= p.AttendanceStatus || 'pending' %></td>
          <td>
            <a href="/participants/edit/<%= p.ParticipantID %>">Edit</a> |
            <a href="/participants/delete/<%= p.ParticipantID %>" onclick="return confirm('Delete this participant?')">Delete</a>
            <form class="inline" method="POST" action="/participants/<%= p.ParticipantID %>/attendance">
              <select name="attendanceStatus">
                <option value="pending" <%= p.AttendanceStatus==='pending'?'selected':'' %>>Pending</option>
                <option value="present" <%= p.AttendanceStatus==='present'?'selected':'' %>>Present</option>
                <option value="absent" <%= p.AttendanceStatus==='absent'?'selected':'' %>>Absent</option>
              </select>
              <button type="submit">Save</button>
            </form>
          </td>
        </tr>
          <% }) %>
        </tbody>
      </table>
      </div>
      <p class="mt-3"><a href="/participants/register" class="btn btn-primary">Register new participant</a></p>
    </div>
  </div>
</body>
</html>
